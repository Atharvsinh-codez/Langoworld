# ğŸ—ï¸ LangoWorld â€” Full Architecture Wireframe

> A complete technical reference explaining every section of the LangoWorld platform.

---

## ğŸ“‹ Table of Contents

1. [System Overview](#-system-overview)
2. [Frontend Architecture](#-frontend-architecture)
3. [Translation System](#-translation-system)
4. [TTS (Text-to-Speech) Pipeline](#-tts-text-to-speech-pipeline)
5. [YouTube Backend](#-youtube-backend)
6. [Video Upload Pipeline](#-video-upload-pipeline)
7. [Document Processing](#-document-processing)
8. [Authentication & Database](#-authentication--database)
9. [API Key Rotation & Queue](#-api-key-rotation--queue)
10. [Data Flow Diagrams](#-data-flow-diagrams)

---

## ğŸŒ System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           USER'S BROWSER                               â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚               React Flow Canvas (Workspace)                      â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚   â”‚ YouTube â”‚  â”‚ Upload  â”‚  â”‚Document â”‚  â”‚  Translation     â”‚  â”‚   â”‚
â”‚  â”‚   â”‚ Input   â”‚  â”‚ Input   â”‚  â”‚ Input   â”‚  â”‚  Panel + History â”‚  â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚        â”‚             â”‚            â”‚                 â”‚             â”‚   â”‚
â”‚  â”‚        â–¼             â–¼            â–¼                 â–¼             â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚   â”‚Summary  â”‚  â”‚Upload   â”‚  â”‚Document â”‚  â”‚Translation Resultâ”‚  â”‚   â”‚
â”‚  â”‚   â”‚Result   â”‚  â”‚Result   â”‚  â”‚Result   â”‚  â”‚Cards + TTS Audio â”‚  â”‚   â”‚
â”‚  â”‚   â”‚Node     â”‚  â”‚Node     â”‚  â”‚Node     â”‚  â”‚Nodes             â”‚  â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                          HTTP Requests (fetch)
                                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        NEXT.JS API ROUTES                               â”‚
â”‚                                                                         â”‚
â”‚  /api/youtube-understand    â†’  Gemini AI summary (queued)              â”‚
â”‚  /api/video-understand      â†’  Gemini video analysis (queued)          â”‚
â”‚  /api/document-understand   â†’  Gemini document analysis                â”‚
â”‚  /api/upload-video          â†’  Cloudflare R2 upload                    â”‚
â”‚  /api/upload-document       â†’  Document file upload                    â”‚
â”‚  /api/translate             â†’  lingo.dev SDK translation               â”‚
â”‚  /api/detect-language       â†’  Auto-detect language (proxy â†’ Python)   â”‚
â”‚  /api/tts                   â†’  Gemini TTS + R2 caching                 â”‚
â”‚  /api/youtube-transcript    â†’  Transcript proxy                        â”‚
â”‚  /api/yt-summary/[id]       â†’  Summary CRUD                           â”‚
â”‚  /api/chapters              â†’  Chapter generation                      â”‚
â”‚  /api/tts-async             â†’  Async TTS via Inngest                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼                    â–¼                    â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Google Gemini  â”‚  â”‚   Supabase     â”‚  â”‚ Cloudflare R2  â”‚
     â”‚  â€¢ AI Summary   â”‚  â”‚   â€¢ Auth       â”‚  â”‚ â€¢ Video CDN    â”‚
     â”‚  â€¢ Video AI     â”‚  â”‚   â€¢ PostgreSQL â”‚  â”‚ â€¢ Audio Cache  â”‚
     â”‚  â€¢ TTS Audio    â”‚  â”‚   â€¢ RLS        â”‚  â”‚ â€¢ Documents    â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
     â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ lingo.devâ”‚   â”‚ Python Flask â”‚
â”‚ i18n SDK â”‚   â”‚ YT Backend   â”‚
â”‚ 25+ langsâ”‚   â”‚ + langdetect â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ :5123        â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¨ Frontend Architecture

### Page Structure

```
app/
â”œâ”€â”€ page.tsx                    â† Landing page (GSAP animated hero)
â”œâ”€â”€ login/page.tsx              â† Supabase email auth login/signup
â”œâ”€â”€ username/page.tsx           â† Username setup after first signup
â”œâ”€â”€ workspace/page.tsx          â† Main workspace (React Flow canvas)
â”œâ”€â”€ yt/
â”‚   â”œâ”€â”€ [slug]/page.tsx         â† Custom URL YouTube pages
â”‚   â””â”€â”€ summary/[id]/page.tsx   â† Full summary detail page
â””â”€â”€ video/                      â† Uploaded video summary pages
```

### Workspace Canvas Architecture

The workspace is built with **React Flow** â€” a node-based canvas where every feature is a draggable node.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    React Flow Canvas                            â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TRIGGER NODES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  [ğŸ”´ YouTube]  [ğŸ“¤ Upload]  [ğŸ“„ Document]  [ğŸŒ Translate] â”‚  â”‚
â”‚  â”‚    Input         Input        Input          Panel         â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚          â”‚          â”‚              â”‚              â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€ animated dashed edges (color-coded) â”€â”€â”€â”€â”€â”         â”‚
â”‚             â”‚          â”‚          â”‚              â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   RESULT NODES                             â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  [Summary Page]  [Upload    [Document   [Translation      â”‚  â”‚
â”‚  â”‚   + TTS + DL]    Result]    Result]     Result Cards Ã—N]  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€ SIDEBAR NODES â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚  â”‚                                â”‚                               â”‚
â”‚  â”‚  [ğŸ“‹ History]  [ğŸ“œ Translation â”‚                               â”‚
â”‚  â”‚   Summaries]    History]       â”‚                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Node Types

| Node Type | Component | Purpose |
|-----------|-----------|---------|
| `youtubeInput` | YouTube URL input + submit button | Paste YouTube link |
| `uploadTrigger` | Upload button + dropzone panel | Upload video files |
| `documentTrigger` | Document upload button + panel | Upload documents |
| `translationTrigger` | Translation panel with language selection | Translate text to multiple languages |
| `summaryPage` | Summary result card with link | View AI summary |
| `uploadResult` | Upload result card | View video analysis |
| `documentResult` | Document result card | View document summary |
| `translationResult` | Translation card with copy + Read Aloud | View translation + TTS playback |
| `historyNode` | Scrollable history list | Browse past summaries |
| `translationHistory` | Translation history list | Browse past translations |

### Edge Types (Animated Connections)

```
YouTube trigger  â”€â”€â”€ blue dashed â”€â”€â”€â–¶  Summary result
Upload trigger   â”€â”€â”€ orange dashed â”€â”€â–¶  Upload result
Document trigger â”€â”€â”€ teal dashed â”€â”€â”€â”€â–¶  Document result
Translate panel  â”€â”€â”€ purple dashed â”€â”€â–¶  Translation cards
History node     â”€â”€â”€ gray dashed â”€â”€â”€â”€â–¶  YouTube trigger
```

### State Management (workspace/page.tsx)

```typescript
// Each feature has INDEPENDENT state â€” all run in parallel

// YouTube
const [ytLoading, setYtLoading]     = useState(false)
const [ytResult, setYtResult]       = useState(null)

// Video Upload
const [uploadLoading, setUploadLoading] = useState(false)
const [uploadResult, setUploadResult]   = useState(null)

// Document
const [docLoading, setDocLoading]   = useState(false)
const [docResult, setDocResult]     = useState(null)

// Translation
const [translationLoading, setTranslationLoading] = useState(false)
const [translationResults, setTranslationResults] = useState([])      // Canvas cards
const [translationHistory, setTranslationHistory] = useState([])      // DB-synced history

// Auth
const [user, setUser]       = useState(null)
const [profile, setProfile] = useState(null)
const [history, setHistory] = useState([])        // Summary history
```

---

## ğŸŒ Translation System

### Complete Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TRANSLATION PANEL (UI)                        â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Source Lang  â”‚  â”‚  Text Input      â”‚  â”‚  Target Languages  â”‚  â”‚
â”‚  â”‚ AUTO-DETECT â”‚  â”‚  "Hello World"   â”‚  â”‚  â˜‘ ES  â˜‘ FR  â˜‘ HI â”‚  â”‚
â”‚  â”‚ âŸ³ detecting â”‚  â”‚                  â”‚  â”‚  â˜ DE  â˜ JA  â˜ KO â”‚  â”‚
â”‚  â”‚ â†’ ğŸ‡¬ğŸ‡§ en 95%â”‚  â”‚  (500ms debounce)â”‚  â”‚  (multi-select)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  Auto-Detect Flow:                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  1. User types text (500ms debounce)                         â”‚ â”‚
â”‚  â”‚  2. POST /api/detect-language â†’ proxy to Python langdetect  â”‚ â”‚
â”‚  â”‚  3. Python returns { code: "en", confidence: 0.95 }         â”‚ â”‚
â”‚  â”‚  4. UI shows: flag + language name + confidence badge        â”‚ â”‚
â”‚  â”‚     â€¢ â‰¥80% â†’ "Auto-detected" (green)                        â”‚ â”‚
â”‚  â”‚     â€¢ â‰¥50% â†’ "Best guess" (yellow)                          â”‚ â”‚
â”‚  â”‚     â€¢ <50% â†’ "Low confidence" (red)                          â”‚ â”‚
â”‚  â”‚  5. If detected lang == target lang â†’ auto-swap target      â”‚ â”‚
â”‚  â”‚  6. Fallback: English (confidence 0) if backend fails       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              [ğŸŒ Translate]  button                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                   User clicks Translate
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SEQUENTIAL TRANSLATION LOOP                        â”‚
â”‚                                                                   â”‚
â”‚  for each targetLang in [ES, FR, HI]:                           â”‚
â”‚    â”‚                                                             â”‚
â”‚    â”œâ”€â”€ POST /api/translate                                       â”‚
â”‚    â”‚   body: { text, targetLocale, sourceLocale }               â”‚
â”‚    â”‚                                                             â”‚
â”‚    â”œâ”€â”€ Server: lingo.dev SDK                                    â”‚
â”‚    â”‚   lingoEngine.localizeText(text, { sourceLocale, target }) â”‚
â”‚    â”‚                                                             â”‚
â”‚    â”œâ”€â”€ Result added to canvas IMMEDIATELY (step-by-step)        â”‚
â”‚    â”‚   setTranslationResults([...allResults])                   â”‚
â”‚    â”‚                                                             â”‚
â”‚    â””â”€â”€ Card appears on canvas:                                   â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚        â”‚ ğŸ‡ªğŸ‡¸ EspaÃ±ol           [ğŸ“‹ Copy] â”‚                      â”‚
â”‚        â”‚ â”€â”€â”€ orange accent bar â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                      â”‚
â”‚        â”‚                                 â”‚                      â”‚
â”‚        â”‚  "Hola Mundo"                   â”‚                      â”‚
â”‚        â”‚                                 â”‚                      â”‚
â”‚        â”‚  ORIGINAL: HELLO WORLD          â”‚                      â”‚
â”‚        â”‚                                 â”‚                      â”‚
â”‚        â”‚  [ğŸ”Š Read Aloud]                â”‚                      â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    After all translations done
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PERSIST TO SUPABASE                                â”‚
â”‚                                                                   â”‚
â”‚  INSERT INTO translation_history                                â”‚
â”‚    user_id:     current user                                     â”‚
â”‚    source_text: "Hello World"                                    â”‚
â”‚    source_lang: "en"                                             â”‚
â”‚    translations: [                                               â”‚
â”‚      { targetLang: "es", translatedText: "Hola Mundo",          â”‚
â”‚        langName: "EspaÃ±ol", flag: "ğŸ‡ªğŸ‡¸" },                      â”‚
â”‚      { targetLang: "fr", translatedText: "Bonjour le monde",   â”‚
â”‚        langName: "FranÃ§ais", flag: "ğŸ‡«ğŸ‡·" },                     â”‚
â”‚      { targetLang: "hi", translatedText: "à¤¨à¤®à¤¸à¥à¤¤à¥‡ à¤¦à¥à¤¨à¤¿à¤¯à¤¾",       â”‚
â”‚        langName: "à¤¹à¤¿à¤¨à¥à¤¦à¥€", flag: "ğŸ‡®ğŸ‡³" }                        â”‚
â”‚    ]                                                             â”‚
â”‚                                                                   â”‚
â”‚  â†’ Local state updated with DB ID for proper deletion           â”‚
â”‚  â†’ History survives page reloads                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Translation History Node

```
â”Œâ”€ Default Position (no panel open) â”€â”€â”€â”€â”€â”€â”
â”‚                                          â”‚
â”‚  Near feature buttons: x:350, y:120     â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ ğŸŒ Translation History        â”‚      â”‚
â”‚  â”‚    2 translations             â”‚      â”‚
â”‚  â”‚                                â”‚      â”‚
â”‚  â”‚  "Hello World"     just now   â”‚      â”‚
â”‚  â”‚  ES                           â”‚      â”‚
â”‚  â”‚                                â”‚      â”‚
â”‚  â”‚  "Good morning"    5m ago     â”‚      â”‚
â”‚  â”‚  FR, HI                       â”‚      â”‚
â”‚  â”‚                                â”‚      â”‚
â”‚  â”‚  [Remove]          [Remove]   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                          â”‚
â”‚  When panel opens â†’ slides to x:1100    â”‚
â”‚  (animated transition, 0.6s ease)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### UI Translation (lingo.dev)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Language Switcher (top-right corner)            â”‚
â”‚                                                   â”‚
â”‚  User selects: Hindi ğŸ‡®ğŸ‡³                         â”‚
â”‚       â”‚                                           â”‚
â”‚       â–¼                                           â”‚
â”‚  LingoProvider (React Context)                   â”‚
â”‚       â”‚                                           â”‚
â”‚       â”œâ”€â”€ Check local cache? â†’ HIT â†’ return      â”‚
â”‚       â”‚                                           â”‚
â”‚       â””â”€â”€ MISS â†’ POST /api/translate              â”‚
â”‚                    body: { text: { all UI keys },  â”‚
â”‚                            sourceLocale: "en",     â”‚
â”‚                            targetLocale: "hi" }    â”‚
â”‚                         â”‚                         â”‚
â”‚                         â–¼                         â”‚
â”‚               lingo.dev SDK (server)              â”‚
â”‚               localizeObject(allKeys)             â”‚
â”‚                         â”‚                         â”‚
â”‚                         â–¼                         â”‚
â”‚               Cache at 3 levels:                  â”‚
â”‚               1. Server memory Map                â”‚
â”‚               2. Client localStorage              â”‚
â”‚               3. React state                      â”‚
â”‚                         â”‚                         â”‚
â”‚                         â–¼                         â”‚
â”‚               t("GET STARTED") â†’ "à¤¶à¥à¤°à¥‚ à¤•à¤°à¥‡à¤‚"       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”Š TTS (Text-to-Speech) Pipeline

### End-to-End Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USER CLICKS "Read Aloud" on Translation Card                       â”‚
â”‚                                                                       â”‚
â”‚  handleSpeak(e) {                                                    â”‚
â”‚    e.stopPropagation()   â† Prevents ReactFlow from stealing click   â”‚
â”‚    e.preventDefault()                                                â”‚
â”‚  }                                                                   â”‚
â”‚                                                                       â”‚
â”‚  Button States:                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  IDLE:     [ğŸ”Š Read Aloud]        (accent border, light bg) â”‚   â”‚
â”‚  â”‚  LOADING:  [â³ Generating...]     (gradient bg, spinner)    â”‚   â”‚
â”‚  â”‚  PLAYING:  [â–®â–®â–®â–® Playing...]     (gradient bg, sound wave)  â”‚   â”‚
â”‚  â”‚  CLICK:    Stops playback         (returns to IDLE)         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    POST /api/tts
                    body: { text, language }
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    /api/tts/route.ts                                  â”‚
â”‚                                                                       â”‚
â”‚  Step 1: Compute Hash                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                    â”‚
â”‚  textHash = MD5(text)                                                â”‚
â”‚  cacheKey = `${textHash}-${language}`                                â”‚
â”‚                                                                       â”‚
â”‚  Step 2: Check R2 Cache                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                               â”‚
â”‚  getCachedAudio(textHash, language)                                  â”‚
â”‚    â”‚                                                                  â”‚
â”‚    â”œâ”€â”€ FOUND â†’ return { audioUrl: "https://r2.dev/...wav" }         â”‚
â”‚    â”‚           (instant, <50ms)                                      â”‚
â”‚    â”‚                                                                  â”‚
â”‚    â””â”€â”€ NOT FOUND â†’ continue to generation                            â”‚
â”‚                                                                       â”‚
â”‚  Step 3: Text Chunking                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                               â”‚
â”‚  If text > 4000 chars â†’ split into chunks                            â”‚
â”‚  Each chunk processed separately                                      â”‚
â”‚                                                                       â”‚
â”‚  Step 4: Gemini TTS API                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                               â”‚
â”‚  getNextApiKey()  â† Smart rotation from key pool                     â”‚
â”‚                                                                       â”‚
â”‚  POST https://generativelanguage.googleapis.com/v1beta/models/       â”‚
â”‚       gemini-2.5-flash:generateContent                               â”‚
â”‚                                                                       â”‚
â”‚  Request:                                                            â”‚
â”‚  {                                                                    â”‚
â”‚    contents: [{ parts: [{ text: "Hola Mundo" }] }],                 â”‚
â”‚    generationConfig: {                                                â”‚
â”‚      responseModalities: ["AUDIO"],                                  â”‚
â”‚      speechConfig: {                                                  â”‚
â”‚        voiceConfig: { prebuiltVoiceConfig: { voiceName: "Kore" } }  â”‚
â”‚      }                                                                â”‚
â”‚    }                                                                  â”‚
â”‚  }                                                                    â”‚
â”‚                                                                       â”‚
â”‚  Response: PCM audio (audio/L16, 24000Hz sample rate)               â”‚
â”‚                                                                       â”‚
â”‚  Step 5: PCM â†’ WAV Conversion                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                       â”‚
â”‚  Add 44-byte WAV header:                                             â”‚
â”‚  â€¢ RIFF header + file size                                           â”‚
â”‚  â€¢ fmt chunk (PCM, mono, 24000Hz, 16-bit)                           â”‚
â”‚  â€¢ data chunk + PCM samples                                         â”‚
â”‚                                                                       â”‚
â”‚  Step 6: Upload to Cloudflare R2                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                     â”‚
â”‚  Key: langoworld/audios/${textHash}-${lang}.wav                     â”‚
â”‚  Content-Type: audio/wav                                             â”‚
â”‚  Public URL: https://pub-xxx.r2.dev/langoworld/audios/xxx.wav       â”‚
â”‚                                                                       â”‚
â”‚  Step 7: Save Metadata                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                â”‚
â”‚  Store in Supabase: hash, language, URL, file size                   â”‚
â”‚                                                                       â”‚
â”‚  Return: { audioUrl, textHash, language, cached: false }             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLIENT PLAYBACK                                                     â”‚
â”‚                                                                       â”‚
â”‚  const audio = new Audio(audioUrl)                                   â”‚
â”‚  audio.onended = () => setSpeaking(false)                            â”‚
â”‚  audio.play()                                                        â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  FALLBACK: If /api/tts fails (any error)                      â”‚   â”‚
â”‚  â”‚                                                                â”‚   â”‚
â”‚  â”‚  â†’ Uses Web Speech API (browser built-in)                     â”‚   â”‚
â”‚  â”‚                                                                â”‚   â”‚
â”‚  â”‚  const utterance = new SpeechSynthesisUtterance(text)         â”‚   â”‚
â”‚  â”‚  utterance.lang = getSpeechLocale(langCode)                   â”‚   â”‚
â”‚  â”‚  utterance.rate = 0.9                                         â”‚   â”‚
â”‚  â”‚  window.speechSynthesis.speak(utterance)                      â”‚   â”‚
â”‚  â”‚                                                                â”‚   â”‚
â”‚  â”‚  Locale mapping: esâ†’es-ES, frâ†’fr-FR, hiâ†’hi-IN, jaâ†’ja-JP...  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### TTS Caching Strategy

```
First request for "Hola Mundo" in Spanish:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Hash: abc123
  Cache key: abc123-es
  R2 lookup: MISS
  Gemini API call: ~2-4 seconds
  Upload to R2: ~500ms
  Total: ~3-5 seconds

Second request (same text):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Hash: abc123 (same)
  R2 lookup: HIT âœ…
  Return cached URL immediately
  Total: ~50ms (instant playback)
```

---

## ğŸ¥ YouTube Backend

### Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    YOUTUBE SUMMARIZATION FLOW                       â”‚
â”‚                                                                     â”‚
â”‚  User pastes: https://youtube.com/watch?v=dQw4w9WgXcQ             â”‚
â”‚       â”‚                                                             â”‚
â”‚       â–¼                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  workspace/page.tsx â†’ handleYoutubeSubmit()                   â”‚  â”‚
â”‚  â”‚                                                                â”‚  â”‚
â”‚  â”‚  POST /api/youtube-understand                                 â”‚  â”‚
â”‚  â”‚  body: { url, userId }                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â”‚                                        â”‚
â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚             â–¼              â–¼              â–¼                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ Step 1:      â”‚  â”‚ Step 2:     â”‚  â”‚ Step 3:          â”‚         â”‚
â”‚  â”‚ Get          â”‚  â”‚ Get         â”‚  â”‚ AI               â”‚         â”‚
â”‚  â”‚ Transcript   â”‚  â”‚ Metadata    â”‚  â”‚ Summarization    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â”‚                  â”‚                   â”‚                    â”‚
â”‚         â–¼                  â–¼                   â–¼                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 1: Transcript Extraction (2 Methods)

```
Method A: Python Flask Backend (Primary)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Python Flask Server (yt-feature/server.py :5123)    â”‚
â”‚                                                       â”‚
â”‚  POST /api/transcript                                â”‚
â”‚  body: { url: "https://youtube.com/watch?v=xxx" }    â”‚
â”‚                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚  pytubefix library         â”‚                      â”‚
â”‚  â”‚                            â”‚                      â”‚
â”‚  â”‚  yt = YouTube(url)         â”‚                      â”‚
â”‚  â”‚  captions = yt.captions    â”‚                      â”‚
â”‚  â”‚                            â”‚                      â”‚
â”‚  â”‚  Priority:                 â”‚                      â”‚
â”‚  â”‚  1. Manual captions (en)   â”‚                      â”‚
â”‚  â”‚  2. Auto-generated (a.en)  â”‚                      â”‚
â”‚  â”‚  3. Any available language â”‚                      â”‚
â”‚  â”‚                            â”‚                      â”‚
â”‚  â”‚  Returns: { transcript,    â”‚                      â”‚
â”‚  â”‚    title, channel,         â”‚                      â”‚
â”‚  â”‚    duration, thumbnail }   â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Method B: NPM youtube-transcript (Fallback)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  /api/youtube-transcript/route.ts                     â”‚
â”‚                                                       â”‚
â”‚  import { YoutubeTranscript } from 'youtube-transcript'â”‚
â”‚                                                       â”‚
â”‚  Used when Python backend is:                        â”‚
â”‚  â€¢ Not running                                        â”‚
â”‚  â€¢ Returns an error                                   â”‚
â”‚  â€¢ Times out (>10s)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 2: AI Summarization (via Request Queue)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  /api/youtube-understand/route.ts                                â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  REQUEST QUEUE (max 5 concurrent)                            â”‚ â”‚
â”‚  â”‚                                                               â”‚ â”‚
â”‚  â”‚  1. Acquire semaphore slot (wait if all 5 busy)              â”‚ â”‚
â”‚  â”‚  2. getNextApiKey() â†’ smart rotation                         â”‚ â”‚
â”‚  â”‚  3. Call Gemini 2.5 Flash                                    â”‚ â”‚
â”‚  â”‚  4. Retry on 429/5xx (exponential backoff)                   â”‚ â”‚
â”‚  â”‚  5. Release semaphore slot                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  Gemini Prompt:                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  "Analyze this video transcript and provide:                 â”‚ â”‚
â”‚  â”‚   1. A comprehensive summary (2-3 paragraphs)               â”‚ â”‚
â”‚  â”‚   2. Key points with timestamps                              â”‚ â”‚
â”‚  â”‚   3. Detailed explanation                                    â”‚ â”‚
â”‚  â”‚   4. TTS-friendly narration text                             â”‚ â”‚
â”‚  â”‚                                                               â”‚ â”‚
â”‚  â”‚   Transcript: [first 4000 words or chunked]"                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  Response saved to Supabase:                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  INSERT INTO summaries (                                     â”‚ â”‚
â”‚  â”‚    user_id, video_url, video_title, channel,                â”‚ â”‚
â”‚  â”‚    summary, key_points, explanation, narration,             â”‚ â”‚
â”‚  â”‚    source: "youtube", created_at                             â”‚ â”‚
â”‚  â”‚  )                                                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  Returns: { pageId, pageUrl, summary, keyPoints }               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Summary Page Features

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  /yt/summary/[id]/page.tsx                                       â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ“º Video Title                                    [Share] â”‚  â”‚
â”‚  â”‚  Channel Name â€¢ Duration                                   â”‚  â”‚
â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  ğŸ“ Summary                                                â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                 â”‚  â”‚
â”‚  â”‚  [AI-generated summary paragraphs]                        â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  ğŸ”‘ Key Points                                             â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                              â”‚  â”‚
â”‚  â”‚  â€¢ 00:30 â€” First key point                                â”‚  â”‚
â”‚  â”‚  â€¢ 02:15 â€” Second key point                               â”‚  â”‚
â”‚  â”‚  â€¢ 05:40 â€” Third key point                                â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  ğŸ“– Chapters (expandable)                                  â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                â”‚  â”‚
â”‚  â”‚  â–¸ Chapter 1: Introduction (00:00 - 02:00)               â”‚  â”‚
â”‚  â”‚  â–¸ Chapter 2: Main Topic (02:00 - 08:00)                 â”‚  â”‚
â”‚  â”‚  â–¸ Chapter 3: Conclusion (08:00 - 10:30)                 â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€ TEXT SELECTION POPUP â”€â”€â”€â”€â”€â”€â”                    â”‚  â”‚
â”‚  â”‚  â”‚  [ğŸ”Š Read Aloud]  [ğŸŒ Translate]  â”‚                    â”‚  â”‚
â”‚  â”‚  â”‚  [ğŸ“‹ Copy]                         â”‚                    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  [ğŸ“¥ Download Markdown]  [ğŸ”Š Listen to Full Summary]     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¤ Video Upload Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User drags video file into Upload Panel                             â”‚
â”‚       â”‚                                                               â”‚
â”‚       â–¼                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Step 1: Upload to Cloudflare R2                                â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  POST /api/upload-video                                         â”‚  â”‚
â”‚  â”‚  body: raw binary (Content-Type: application/octet-stream)      â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  Server:                                                        â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ Generate unique filename: `${userId}/${timestamp}-${name}` â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ PutObjectCommand to R2 bucket                              â”‚  â”‚
â”‚  â”‚  â””â”€â”€ Return: { url: "https://r2.dev/videos/..." }              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚                                â”‚
â”‚                                      â–¼                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Step 2: Gemini Video Analysis                                  â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  POST /api/video-understand                                     â”‚  â”‚
â”‚  â”‚  body: { videoUrl, userId }                                     â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  Server (via Request Queue):                                    â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ Download video from R2                                     â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ Send to Gemini as video input (supports direct files)     â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ Generate: summary, key points, explanation                â”‚  â”‚
â”‚  â”‚  â””â”€â”€ Save to Supabase (source: "upload")                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚                                â”‚
â”‚                                      â–¼                                â”‚
â”‚  Result appears as orange-edged node on canvas                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“„ Document Processing

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User uploads document (PDF, DOCX, TXT, etc.)                       â”‚
â”‚       â”‚                                                               â”‚
â”‚       â–¼                                                               â”‚
â”‚  POST /api/upload-document                                           â”‚
â”‚  â†’ Stores file, extracts text content                               â”‚
â”‚       â”‚                                                               â”‚
â”‚       â–¼                                                               â”‚
â”‚  POST /api/document-understand                                       â”‚
â”‚  â†’ Gemini AI analyzes document content                              â”‚
â”‚  â†’ Generates summary, key insights, and structure                   â”‚
â”‚       â”‚                                                               â”‚
â”‚       â–¼                                                               â”‚
â”‚  Save to Supabase (source: "document")                              â”‚
â”‚  Result appears as teal-edged node on canvas                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Authentication & Database

### Auth Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AUTHENTICATION FLOW                           â”‚
â”‚                                                                   â”‚
â”‚  Landing Page (/page.tsx)                                        â”‚
â”‚       â”‚                                                           â”‚
â”‚       â””â”€â”€ Click "Get Started"                                    â”‚
â”‚                â”‚                                                  â”‚
â”‚                â–¼                                                  â”‚
â”‚  Login Page (/login/page.tsx)                                    â”‚
â”‚       â”‚                                                           â”‚
â”‚       â”œâ”€â”€ Sign Up (email + password)                             â”‚
â”‚       â”‚     â”‚                                                     â”‚
â”‚       â”‚     â”œâ”€â”€ supabase.auth.signUp()                          â”‚
â”‚       â”‚     â””â”€â”€ â†’ /username (set display name)                  â”‚
â”‚       â”‚           â”‚                                               â”‚
â”‚       â”‚           â”œâ”€â”€ INSERT INTO profiles                       â”‚
â”‚       â”‚           â””â”€â”€ â†’ /workspace (main app)                   â”‚
â”‚       â”‚                                                           â”‚
â”‚       â””â”€â”€ Sign In (email + password)                             â”‚
â”‚             â”‚                                                     â”‚
â”‚             â”œâ”€â”€ supabase.auth.signInWithPassword()               â”‚
â”‚             â””â”€â”€ â†’ /workspace (main app)                          â”‚
â”‚                                                                   â”‚
â”‚  Middleware (middleware.ts):                                      â”‚
â”‚  â”œâ”€â”€ Checks Supabase session on every request                   â”‚
â”‚  â”œâ”€â”€ Protected routes: /workspace, /yt/*                        â”‚
â”‚  â””â”€â”€ Redirects to /login if not authenticated                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Database Schema

```sql
-- Users & Profiles
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  profiles                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                          â”‚
â”‚  id          UUID (PK, â†’ auth.users)â”‚
â”‚  username    TEXT (unique)          â”‚
â”‚  display_name TEXT                  â”‚
â”‚  avatar_url  TEXT                   â”‚
â”‚  created_at  TIMESTAMPTZ           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

-- Video Summaries (YouTube + Upload + Document)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  summaries                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”‚
â”‚  id          UUID (PK)             â”‚
â”‚  user_id     UUID (â†’ auth.users)   â”‚
â”‚  video_url   TEXT                   â”‚
â”‚  video_title TEXT                   â”‚
â”‚  channel     TEXT                   â”‚
â”‚  summary     TEXT                   â”‚
â”‚  key_points  JSONB                  â”‚
â”‚  explanation TEXT                   â”‚
â”‚  narration   TEXT                   â”‚
â”‚  source      TEXT (youtube/upload/document)  â”‚
â”‚  slug        TEXT (custom URL)     â”‚
â”‚  created_at  TIMESTAMPTZ           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

-- Translation History (persistent)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  translation_history                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”‚
â”‚  id          UUID (PK)             â”‚
â”‚  user_id     UUID (â†’ auth.users)   â”‚
â”‚  source_text TEXT                   â”‚
â”‚  source_lang VARCHAR(10)           â”‚
â”‚  translations JSONB                 â”‚
â”‚    â†’ [{targetLang, translatedText, â”‚
â”‚        langName, flag}]            â”‚
â”‚  created_at  TIMESTAMPTZ           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

-- Row-Level Security (ALL tables)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Every table has RLS enabled:                    â”‚
â”‚  â€¢ Users can only SELECT their own rows          â”‚
â”‚  â€¢ Users can only INSERT with their own user_id  â”‚
â”‚  â€¢ Users can only DELETE their own rows          â”‚
â”‚  â€¢ Enforced at database level (not app logic)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ›¡ï¸ API Key Rotation & Queue

### Smart API Key Rotation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API KEY POOL (from GOOGLE_API_KEYS env var)                â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Key #1   â”‚ Key #2 â”‚ Key #3   â”‚ Key #4     â”‚ Key #5     â”‚ â”‚
â”‚  â”‚ âœ… ok    â”‚ â¸ï¸ cool â”‚ âœ… ok    â”‚ âŒ dead    â”‚ âœ… ok      â”‚ â”‚
â”‚  â”‚ 0 fails  â”‚ down   â”‚ 1 fail   â”‚ 3+ fails   â”‚ 0 fails   â”‚ â”‚
â”‚  â”‚          â”‚ 45s    â”‚ (resets  â”‚ (skipped)  â”‚            â”‚ â”‚
â”‚  â”‚          â”‚ left   â”‚  in 5m)  â”‚            â”‚ â† SELECTEDâ”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚  Selection Algorithm:                                        â”‚
â”‚  1. Filter out keys in cooldown (429 within last 60s)       â”‚
â”‚  2. Filter out unhealthy keys (3+ consecutive failures)     â”‚
â”‚  3. Sort remaining by: fewest failures â†’ least recently used â”‚
â”‚  4. Select top key                                           â”‚
â”‚  5. Fallback: if ALL keys bad, use least-recently-failed    â”‚
â”‚                                                               â”‚
â”‚  On Success: markKeySuccess(keyIndex)                        â”‚
â”‚    â†’ Reset failure count to 0                                â”‚
â”‚    â†’ Record success timestamp                                â”‚
â”‚                                                               â”‚
â”‚  On 429: markKeyRateLimited(keyIndex)                       â”‚
â”‚    â†’ Enter 60-second cooldown                                â”‚
â”‚    â†’ Key skipped during cooldown                             â”‚
â”‚                                                               â”‚
â”‚  On Error: markKeyFailure(keyIndex)                         â”‚
â”‚    â†’ Increment failure count                                 â”‚
â”‚    â†’ After 3 failures â†’ key marked unhealthy                â”‚
â”‚    â†’ Auto-recovery: failure count resets after 5min idle     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Request Queue

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CONCURRENCY QUEUE (lib/request-queue.ts)                   â”‚
â”‚                                                               â”‚
â”‚  Max Concurrent: 5 Gemini API calls                         â”‚
â”‚  Max Retries: 3 per request                                  â”‚
â”‚  Backoff: Exponential (1s â†’ 2s â†’ 4s + jitter, max 30s)     â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€ Active Slots â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€ Waiting Queue â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ [Req A] [Req B] [Req C]â”‚  â”‚ [Req F] [Req G] ...   â”‚     â”‚
â”‚  â”‚ [Req D] [Req E]        â”‚  â”‚                        â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                               â”‚
â”‚  Error Handling:                                             â”‚
â”‚  â”œâ”€â”€ 429 (Rate Limit) â†’ Retry with cooldown                â”‚
â”‚  â”œâ”€â”€ 500, 502, 503    â†’ Retry with backoff                 â”‚
â”‚  â”œâ”€â”€ Timeout (>30s)   â†’ Retry with next key                â”‚
â”‚  â”œâ”€â”€ 400 (Bad Request) â†’ Fail immediately (no retry)       â”‚
â”‚  â””â”€â”€ 403 (Forbidden)  â†’ Fail immediately (key invalid)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Data Flow Diagrams

### Complete Request Lifecycle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User   â”‚     â”‚ Next.js  â”‚     â”‚ Request  â”‚     â”‚ Gemini   â”‚
â”‚ Browser â”‚     â”‚ API Routeâ”‚     â”‚ Queue    â”‚     â”‚ API      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚               â”‚               â”‚               â”‚
     â”‚â”€â”€â”€â”€ POST â”€â”€â”€â”€â–¶â”‚               â”‚               â”‚
     â”‚  /api/youtube  â”‚               â”‚               â”‚
     â”‚  -understand   â”‚               â”‚               â”‚
     â”‚               â”‚               â”‚               â”‚
     â”‚               â”‚â”€ enqueue() â”€â”€â–¶â”‚               â”‚
     â”‚               â”‚               â”‚               â”‚
     â”‚               â”‚               â”‚â”€â”€ acquire â”€â”€â”€â–¶â”‚
     â”‚               â”‚               â”‚   semaphore   â”‚
     â”‚               â”‚               â”‚               â”‚
     â”‚               â”‚               â”‚â”€â”€ getKey() â”€â”€â–¶â”‚ (rotation)
     â”‚               â”‚               â”‚               â”‚
     â”‚               â”‚               â”‚â”€â”€â”€â”€ POST â”€â”€â”€â”€â–¶â”‚
     â”‚               â”‚               â”‚   Gemini API  â”‚
     â”‚               â”‚               â”‚               â”‚
     â”‚               â”‚               â”‚â—€â”€â”€ Response â”€â”€â”‚
     â”‚               â”‚               â”‚               â”‚
     â”‚               â”‚               â”‚â”€â”€ release â”€â”€â”€â–¶â”‚
     â”‚               â”‚               â”‚   semaphore   â”‚
     â”‚               â”‚               â”‚               â”‚
     â”‚               â”‚â—€â”€ result() â”€â”€â”‚               â”‚
     â”‚               â”‚               â”‚               â”‚
     â”‚               â”‚â”€â”€ save to â”€â”€â–¶ Supabase        â”‚
     â”‚               â”‚               â”‚               â”‚
     â”‚â—€â”€â”€ JSON â”€â”€â”€â”€â”€â”‚               â”‚               â”‚
     â”‚  response     â”‚               â”‚               â”‚
     â”‚               â”‚               â”‚               â”‚
     â”‚â”€â”€ render â”€â”€â”€â”€â–¶ Canvas node    â”‚               â”‚
     â”‚               â”‚               â”‚               â”‚
```

### File Organization Summary

```
KEY FILES AND WHAT THEY DO:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

FRONTEND (React/Next.js)
â”œâ”€â”€ langoworld-flow.tsx          â†’ THE main canvas component
â”‚   â”œâ”€â”€ 10 node types (YouTube, Upload, Document, Translation...)
â”‚   â”œâ”€â”€ Edge rendering with animations
â”‚   â”œâ”€â”€ TTS playback (Gemini + Web Speech fallback)
â”‚   â””â”€â”€ Copy, drag, interaction handlers
â”‚
â”œâ”€â”€ workspace/page.tsx           â†’ THE workspace page
â”‚   â”œâ”€â”€ All feature state management
â”‚   â”œâ”€â”€ API call handlers (YouTube, Upload, Translate)
â”‚   â”œâ”€â”€ Supabase load/save for all data
â”‚   â””â”€â”€ Translation history persistence
â”‚
â”œâ”€â”€ workspace/translation-panel.tsx â†’ Translation input UI
â”‚   â”œâ”€â”€ Source/target language dropdowns (20 languages)
â”‚   â”œâ”€â”€ Multi-language selection grid
â”‚   â””â”€â”€ Text input + submit
â”‚
â””â”€â”€ lib/lingo.tsx                â†’ i18n context provider
    â”œâ”€â”€ LingoProvider wraps entire app
    â”œâ”€â”€ useLingo() hook â†’ t() function
    â””â”€â”€ 3-layer cache (server mem + localStorage + React state)

API ROUTES
â”œâ”€â”€ /api/tts/route.ts            â†’ Gemini TTS + R2 caching
â”œâ”€â”€ /api/translate/route.ts      â†’ lingo.dev SDK wrapper
â”œâ”€â”€ /api/youtube-understand/     â†’ AI summarization (queued)
â”œâ”€â”€ /api/video-understand/       â†’ Video analysis (queued)
â”œâ”€â”€ /api/document-understand/    â†’ Document analysis
â”œâ”€â”€ /api/upload-video/           â†’ R2 video upload
â””â”€â”€ /api/upload-document/        â†’ Document upload

INFRASTRUCTURE
â”œâ”€â”€ lib/api-key-rotation.ts      â†’ Smart per-key health tracking
â”œâ”€â”€ lib/request-queue.ts         â†’ Concurrency queue + retry
â”œâ”€â”€ lib/r2-client.ts             â†’ Cloudflare R2 S3 client
â”œâ”€â”€ lib/audio-storage.ts         â†’ Audio file cache management
â”œâ”€â”€ lib/supabase-browser.ts      â†’ Supabase client (browser)
â””â”€â”€ lib/supabase-server.ts       â†’ Supabase client (server)

PYTHON BACKEND
â””â”€â”€ yt-feature/
    â”œâ”€â”€ server.py                â†’ Flask API (:5123)
    â”œâ”€â”€ services/youtube.py      â†’ Video ID extraction
    â”œâ”€â”€ services/transcript.py   â†’ Caption/transcript fetcher
    â””â”€â”€ services/gemini.py       â†’ Gemini API client
```

---

<p align="center">
  <strong>LangoWorld Architecture v1.0</strong>
  <br/>
  <sub>16 February 2026 By Atharvsinh Jadav</sub>
</p>
